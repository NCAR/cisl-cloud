
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Hosting on k8s &#8212; CISL Cloud Pilot</title>
    
  <link href="../../_static/css/theme.css" rel="stylesheet">
  <link href="../../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-pythia-theme.min.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/style.css" />
    
  <link rel="preload" as="script" href="../../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js"></script>
    <script src="../../_static/sphinx-book-theme.d59cb220de22ca1c485ebbdc042f0030.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Using the NCAR kubernetes (k8s) clusters" href="../K8s/k8s-intro.html" />
    <link rel="prev" title="Add content" href="add-jb.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="132">
    <div class="container-fluid" id="shim"></div>
    <div class="container-fluid" id="banner"></div>
    <nav class="navbar navbar-dark navbar-expand-lg bg-dark fixed-top bd-navbar shadow" id="navbar-main"><div class="container-xl">

  <div id="navbar-start">
    
    

<a class="navbar-brand" href="../../index.html">
  <img src="../../_static/CISL-contemp-logo-blue.png" class="logo" alt="logo">
</a>


    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  
  <div id="navbar-collapsible" class="col-lg-9 collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <ul id="navbar-main-elements" class="navbar-nav">

       
        
            
        
        <li class="nav-item">
            <a class="nav-link nav-internal" href="../../index.html">Cloud Docs</a>
        </li>    
    
    
    
        <div class="dropdown">
        
            
        
            <li class="nav-item">
                <button class="dropbtn">
                    <a class="nav-link nav-internal" href="../../overview/services.html">
                        Resources <i class="fa fa-chevron-down" style="color: #000000;"></i>
                    </a>
                </button>
            </li>
            <div class="dropdown-content">
                
                    <a class="dropdown-link" href="https://jupyter.k8s.ucar.edu/">
                        NCAR JupyterHub
                    </a><br>
                
                    <a class="dropdown-link" href="https://ncar-cisl.2i2c.cloud/hub/login">
                        2i2c JupyterHub
                    </a><br>
                
                    <a class="dropdown-link" href="https://rancher.k8s.ucar.edu/">
                        Rancher
                    </a><br>
                
                    <a class="dropdown-link" href="https://ithelp.ucar.edu/servicedesk/customer/portal/2/create/17">
                        Request VM
                    </a><br>
                
                    <a class="dropdown-link" href="https://stratus-admin.ucar.edu:10443/asview">
                        Stratus
                    </a><br>
                
            </div>
        </div>
    
    
       
        
            
        
        <li class="nav-item">
            <a class="nav-link nav-internal" href="https://www2.cisl.ucar.edu/">CISL Home</a>
        </li>    
    
    
       
        
            
        
        <li class="nav-item">
            <a class="nav-link nav-internal" href="https://jira.ucar.edu/secure/CreateIssueDetails!init.jspa?pid=18470&issuetype=10905">Report issue</a>
        </li>    
    
    

</ul>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
      </ul>
      </div>
      
    </div>
  </div>
</div>
    </nav>
    <div class="container-xl">
      <div class="row">
        
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../overview/about.html">
   About this Project
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../overview/use-cases.html">
   Use Cases
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../overview/goals.html">
   Goals
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../overview/services.html">
   Potential Services
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Availability
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../availability/availability.html">
   Current Offering
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../availability/hw-resources.html">
   Hardware
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Administer the CISL Cloud
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="jb-intro.html">
   Jupyter Book
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="create-jb.html">
     Create CCPP Docs
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="add-jb.html">
     Add content
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Hosting on k8s
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../K8s/k8s-intro.html">
   Kubernetes (k8s)
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../K8s/Hosting/web-hosting.html">
     Host web applications
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
    <label for="toctree-checkbox-3">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../K8s/Hosting/web-kubectl.html">
       Deploy with
       <code class="docutils literal notranslate">
        <span class="pre">
         kubectl
        </span>
       </code>
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../K8s/Hosting/web-helm.html">
       Deploy with Helm
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../K8s/Rancher/rancher-intro.html">
     Rancher (K8s)
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
    <label for="toctree-checkbox-4">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../K8s/Rancher/get-kubeconfig.html">
       Get a kubeconfig
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../K8s/Rancher/create-namespace.html">
       Create namespace
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../K8s/Rancher/cluster-access.html">
       Accessing a k8s Cluster
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../K8s/Rancher/permissions.html">
       Permissions
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../k8sJH/customize/custom.html">
     Customize JupyterHub
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
    <label for="toctree-checkbox-5">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../k8sJH/customize/customize-docker.html">
       Docker Image
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../k8sJH/customize/setup-gh-act.html">
       GitHub Actions
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Use the CISL Cloud
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../2i2cJH/2i2cJH-intro.html">
   2i2c JupyterHub
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
  <label for="toctree-checkbox-6">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../2i2cJH/access.html">
     Requesting Access
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../2i2cJH/user-info.html">
     User Information
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../agile.html">
   Agile Interaction
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
  <label for="toctree-checkbox-7">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../create-tickets.html">
     Create tickets
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../k8sJH/k8sJH-intro.html">
   NCAR JupyterHub
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/>
  <label for="toctree-checkbox-8">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../k8sJH/access.html">
     Requesting Access
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../k8sJH/customize/env.html">
     Conda Environments
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../k8sJH/customize/github.html">
     Utilizing GitHub
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../k8sJH/base-conda.html">
     Base Conda Environment
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../k8sJH/user-info.html">
     User Information
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../K8s/Hosting/web-intro.html">
   Hosting web applications
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/>
  <label for="toctree-checkbox-9">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../K8s/Hosting/containerize.html">
     Containerize Python app
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../K8s/Hosting/book-image.html">
     Containerize Jupyter Book
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../K8s/Hosting/deploy.html">
     Deploy your application
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../Stratus/stratus-intro.html">
   Stratus
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/>
  <label for="toctree-checkbox-10">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../Stratus/stratus-access.html">
     Access
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Stratus/jupyter-extension.html">
     Jupyter S3 Extension
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Stratus/stratus-cmd.html">
     Python Examples
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../vm/vm-intro.html">
   Virtual Machines
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Support Agreements
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../slas/slas.html">
   SLA’s
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/>
  <label for="toctree-checkbox-11">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../slas/glade.html">
     GLADE
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../slas/stratus.html">
     Stratus
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../slas/ncar-jh.html">
     NCAR JupyterHub
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference external" href="https://docs.2i2c.org/support/">
     2i2c JupyterHub
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Contact Us
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../contact.html">
   Information
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  <p style="font-weight: 700;text-decoration: underline;color: red;">This site is currently in active development.</p>
Follow our <a href="https://jira.ucar.edu/secure/RapidBoard.jspa?rapidView=220&projectKey=CCPP">Kanban board</a><br>
Visit our <a href="https://github.com/NCAR/cisl-cloud">GitHub Repo</a><hr>
<div>Powered by <a href="https://jupyterbook.org">Jupyter Book</a></div><br>
Theme by <a href="https://projectpythia.org/">Project Pythia</a>

</div>

</div>

        

        <main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main"><div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../../_sources/how-to/jupyter-book/k8s-hosting.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
                onclick="printPdf(this)" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/NCAR/cisl-cloud"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/NCAR/cisl-cloud/issues/new?title=Issue%20on%20page%20%2Fhow-to/jupyter-book/k8s-hosting.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show noprint">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> On this page
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#updating-the-image">
   Updating the image
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#locally-tag-and-push">
     Locally tag and push
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#update-github-workflow-file">
     Update GitHub workflow file
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#upgrade-helm">
   Upgrade Helm
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
          <div id="main-content" class="row">
            <div class="col-12 col-md-9 pl-md-3 pr-md-0">
              
              <div>
                
  <div class="tex2jax_ignore mathjax_ignore section" id="hosting-on-k8s">
<h1>Hosting on k8s<a class="headerlink" href="#hosting-on-k8s" title="Permalink to this headline">¶</a></h1>
<p>A containerized version of the documentation is hosted on the NCAR | CISL k8s cluster and can be viewed at <a class="reference external" href="https://cloud-docs.k8s.ucar.edu/">https://cloud-docs.k8s.ucar.edu/</a>.</p>
<div class="section" id="updating-the-image">
<h2>Updating the image<a class="headerlink" href="#updating-the-image" title="Permalink to this headline">¶</a></h2>
<p>By default any changes pushed to the <code class="docutils literal notranslate"><span class="pre">docs/_build/html/</span></code> directory will trigger a GitHub action that will build a new image, named <code class="docutils literal notranslate"><span class="pre">docs:latest</span></code>, and push it to the cislcloudpilot Docker Hub repository. You should test any changes to this image locally before making changes to the hosted version with the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">run</span> <span class="o">--</span><span class="n">pull</span> <span class="n">always</span> <span class="o">-</span><span class="n">p</span> <span class="mi">80</span><span class="p">:</span><span class="mi">80</span> <span class="n">cislcloudpilot</span><span class="o">/</span><span class="n">docs</span><span class="p">:</span><span class="n">latest</span> 
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The flag <code class="docutils literal notranslate"><span class="pre">--pull</span></code> has been set to always to ensure the latest version on Docker Hub is being run</p>
</div>
<p>If the changes look good it’s time to push a new image tag to the container registry. This can be done 1 of 2 ways.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Right now a production version of the image is tagged with the date it was released in the format month.day.year such as <code class="docutils literal notranslate"><span class="pre">Aug.8.23</span></code>.</p>
</div>
<div class="section" id="locally-tag-and-push">
<h3>Locally tag and push<a class="headerlink" href="#locally-tag-and-push" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In order to successfully push the image to Docker Hub you will need to login with the following command : <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">login</span> <span class="pre">--username=cislcloudpilot</span></code>. If you do not have the password contact Nick Cote to get access to the KeePass file that contains it.</p>
</div>
<p>Since we just pulled down the <code class="docutils literal notranslate"><span class="pre">:latest</span></code> image to test our changes we can change the tag locally and push the new image tag back to the container registry. An example of how to do this is as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">image</span> <span class="n">tag</span> <span class="n">cislcloutpilot</span><span class="o">/</span><span class="n">docs</span><span class="p">:</span><span class="n">latest</span> <span class="n">cislcloudpilot</span><span class="o">/</span><span class="n">docs</span><span class="p">:</span><span class="n">Aug</span><span class="mf">.8.23</span>
<span class="n">docker</span> <span class="n">image</span> <span class="n">push</span> <span class="n">cislcloudpilot</span><span class="o">/</span><span class="n">docs</span><span class="p">:</span><span class="n">Aug</span><span class="mf">.8.23</span>
</pre></div>
</div>
</div>
<div class="section" id="update-github-workflow-file">
<h3>Update GitHub workflow file<a class="headerlink" href="#update-github-workflow-file" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The GitHub workflow file should be changed and pushed to GitHub <em><strong>before, or at the same time,</strong></em> as final changes made to <code class="docutils literal notranslate"><span class="pre">docs/_build/html/</span></code> are pushed to make sure the released image tag is applied when the Action is triggered by the change to <code class="docutils literal notranslate"><span class="pre">docs/_build/html/</span></code>.</p>
</div>
<p>The GitHub workflow file found <a class="reference external" href="https://github.com/NCAR/cisl-cloud/blob/main/.github/workflows/build-push-docs.yaml">here</a> defines the tags to push to Docker Hub. As of the writing of this document it’s accomplished on line #48 with line #49 providing the default value : <code class="docutils literal notranslate"><span class="pre">cislcloudpilot/docs:latest</span></code>. Additional lines can be added to provide additional tags. Update the yaml file to include the new tag under line #48 and push the changes to GitHub making sure to take in to account the note above. Check the status of the new image build and push at the GitHub actions page <a class="reference external" href="https://github.com/NCAR/cisl-cloud/actions">here</a>.</p>
</div>
</div>
<div class="section" id="upgrade-helm">
<h2>Upgrade Helm<a class="headerlink" href="#upgrade-helm" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This document assumes you have a kubeconfig file for the cluster and it is active. Documentation on how to accomplish this can be found <a class="reference internal" href="../K8s/Rancher/get-kubeconfig.html"><span class="doc std std-doc">here</span></a>.</p>
</div>
<p>The cloud documentation was deployed on k8s using a helm chart. Instructions on how to accomplish this in more detail can be found <a class="reference internal" href="../K8s/Hosting/web-helm.html"><span class="doc std std-doc">here</span></a>. Once you have a new docs image built, tagged, and pushed to Docker Hub it’s time to update the helm chart hosted <a class="reference external" href="https://github.com/NCAR/cisl-cloud/tree/main/configs/helm-charts/cloud-docs">here</a>. More specifically we are going to change the <code class="docutils literal notranslate"><span class="pre">webapp.container.image</span></code> value that is set in the <code class="docutils literal notranslate"><span class="pre">values.yml</span></code> file and update the release information in <code class="docutils literal notranslate"><span class="pre">Chart.yaml</span></code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code class="docutils literal notranslate"><span class="pre">appVersion</span></code> in <code class="docutils literal notranslate"><span class="pre">Chart.yaml</span></code> should directly match the image tag used in the container image. The proper <code class="docutils literal notranslate"><span class="pre">version</span></code> value should be incremented by 1 knowing that <code class="docutils literal notranslate"><span class="pre">version</span></code> is set to major.minor.patch. New content would be a change to the minor version number while any fixes that are implemented would be a change in the patch version number. The major version only changes when a very large change is made that ultimately affects how you interact with the image.</p>
</div>
<p>With those changes in place to the helm chart files it’s time to update the application on k8s. This is accomplished by running the following command in the <code class="docutils literal notranslate"><span class="pre">helm-charts</span></code> directory :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">helm</span> <span class="n">upgrade</span> <span class="o">-</span><span class="n">n</span> <span class="n">ncote</span><span class="o">-</span><span class="n">test</span> <span class="n">cloud</span><span class="o">-</span><span class="n">docs</span> <span class="n">cloud</span><span class="o">-</span><span class="n">docs</span><span class="o">/</span>
</pre></div>
</div>
<p>If everything runs successfully you should see output that looks like the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Release &quot;cloud-docs&quot; has been upgraded. Happy Helming!
NAME: cloud-docs
LAST DEPLOYED: Wed Aug  9 12:06:41 2023
NAMESPACE: ncote-test
STATUS: deployed
REVISION: 2
TEST SUITE: None
</pre></div>
</div>
<p>If there’s an issue Helm should let you know what it is. Please address it and run the upgrade command again until it succeeds. If you have issues that you are unable to overcome please reach out to a team member for assistance.</p>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./how-to/jupyter-book"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="add-jb.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Add content</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="../K8s/k8s-intro.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Using the NCAR kubernetes (k8s) clusters</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </div>
          </div>
        </main>

      </div>
    </div>
  
  <script src="../../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

<footer class="footer">
  <div class="container-fluid m-0 p-0">
  
    <div class="footer-item">
    
    </div>
  
    <div class="footer-item">
    <style>
  @import url('https://fonts.googleapis.com/css?family=Poppins:400,600,700');
</style>
<div class="grid-x grid-padding-y footer-menu-tertiary">
  <div class="cell text-center custom-footer">
      <small>©  UCAR</small>
          <a href="https://www.ucar.edu/privacy-notice" class="custom-footer-link">Privacy</a>
          <a href="https://www.ucar.edu/cookie-other-tracking-technologies-notice" class="custom-footer-link">Cookies</a>
          <a href="https://www.ucar.edu/terms-of-use" class="custom-footer-link">Terms of Use</a>
          <a href="https://www.ucar.edu/notification-copyright-infringement-digital-millenium-copyright-act" class="custom-footer-link">Copyright Issues</a>
          <a href="https://nsf.gov" class="custom-footer-link">Sponsored by NSF</a>
          <a href="https://ncar.ucar.edu" class="custom-footer-link">NCAR Home</a>
          <a href="https://www.ucar.edu" class="custom-footer-link">UCAR Home</a>
      </ul>
  </div>
</div>
    </div>
  
    <div class="footer-item">
      <div class="container-fluid footer-info">
    <div class="container-xl">
      <div class="d-flex justify-content-center">
        <p class="py-1 m-0">
            &copy;&nbsp;2023.
        
          By The CISL Cloud Pilot Team.
        
          Last updated on 10 August 2023.
        </p>
      </div>
    </div>
  </div>
    </div>
  
    <div class="footer-item">
    <div class="container-fluid footer-extra">
    <div class="container">
      <center>
        Theme by <a href="https://projectpythia.org">Project Pythia</a>. All code
        in Pythia Foundations is licensed under Apache 2.0. All other non-code
        content is licensed under
        <a href="https://creativecommons.org/licenses/by/4.0/">
          Creative Commons BY 4.0 (CC BY 4.0)</a
        >.
      </center>
      <br />
      <div class="row">
        <p class="m-0">
          <img
            src="../../_static/footer-logo-nsf.png"
            style="float: left; width: 60px; height: 60px; margin-right: 1rem"
          />
          This material is based upon work supported by the National Science
          Foundation. Any opinions, findings,
          and conclusions or recommendations expressed in this material are those
          of the author(s) and do not necessarily reflect the views of the
          National Science Foundation.
        </p>
      </div>
    </div>
  </div>
    </div>
  
  </div>
</footer>
  </body>
</html>